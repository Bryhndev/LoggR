<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
  <meta name="apple-mobile-web-app-title" content="LoggR"/>
  <title>LoggR</title>
  <link rel="manifest" href="manifest.json"/>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      background: #000;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    .header {
  padding: 12px 16px;
  border-bottom: 1px solid #1a1a1a;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-shrink: 0;
  overflow: hidden;
}

.header-tittel {
  font-size: clamp(0.4rem, 2.8vw, 0.75rem);
  letter-spacing: 0.05em;
  color: #555;
  white-space: nowrap;
  flex-shrink: 0;
}

.header-logg {
  font-size: clamp(0.4rem, 2.8vw, 0.75rem);
  color: #333;
  max-width: 45%;
  text-align: right;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  flex-shrink: 1;
}

    /* ‚îÄ‚îÄ LOGG-VISNING ‚îÄ‚îÄ */
    .logg-visning {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .logg-linje {
      font-size: 0.95rem;
      color: #ccc;
      line-height: 1.6;
      padding: 8px 0;
      border-bottom: 1px solid #111;
      display: flex;
      gap: 10px;
      align-items: flex-start;
    }

    .logg-linje .tid {
      color: #444;
      font-size: 0.8rem;
      flex-shrink: 0;
      margin-top: 2px;
    }

    .logg-linje .tekst {
      flex: 1;
    }

    .tom-melding {
      color: #333;
      font-size: 0.9rem;
      text-align: center;
      margin-top: 40px;
      letter-spacing: 0.1em;
    }

    /* ‚îÄ‚îÄ INPUT ‚îÄ‚îÄ */
    .input-omrade {
      border-top: 1px solid #1a1a1a;
      padding: 12px 16px;
      display: flex;
      gap: 10px;
      align-items: center;
      flex-shrink: 0;
      background: #000;
    }

    .input-felt {
      flex: 1;
      background: #111;
      border: 1px solid #222;
      color: #fff;
      padding: 12px 16px;
      font-size: 1rem;
      border-radius: 4px;
      outline: none;
      font-family: inherit;
    }

    .input-felt::placeholder { color: #333; }

    .send-knapp {
      background: #fff;
      color: #000;
      border: none;
      padding: 12px 20px;
      font-size: 1rem;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      flex-shrink: 0;
    }

    .send-knapp:active { background: #ccc; }

    /* ‚îÄ‚îÄ MENY ‚îÄ‚îÄ */
    .meny-knapp {
      background: none;
      border: 1px solid #222;
      color: #555;
      padding: 8px 12px;
      font-size: 0.75rem;
      letter-spacing: 0.1em;
      cursor: pointer;
      border-radius: 4px;
    }

    .meny-knapp:active { border-color: #555; color: #fff; }

    /* ‚îÄ‚îÄ OVERLAY ‚îÄ‚îÄ */
    .overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #000;
      z-index: 10;
      flex-direction: column;
    }

    .overlay.aktiv { display: flex; }

    .overlay-header {
      padding: 16px;
      border-bottom: 1px solid #1a1a1a;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .overlay-tittel {
      font-size: 0.85rem;
      letter-spacing: 0.15em;
      color: #fff;
    }

    .lukk-knapp {
      background: none;
      border: none;
      color: #555;
      font-size: 1.2rem;
      cursor: pointer;
      padding: 4px 8px;
    }

    .overlay-innhold {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }

    /* ‚îÄ‚îÄ STARTUP OVERLAY ‚îÄ‚îÄ */
    .startup-overlay {
      display: flex;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #000;
      z-index: 20;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px;
      text-align: center;
    }

    .startup-logo {
      font-size: 2rem;
      font-weight: 800;
      letter-spacing: 0.15em;
      margin-bottom: 8px;
    }

    .startup-sub {
      font-size: 0.75rem;
      color: #444;
      letter-spacing: 0.1em;
      margin-bottom: 48px;
    }

    .startup-info {
      font-size: 0.85rem;
      color: #555;
      margin-bottom: 32px;
      line-height: 1.8;
    }

    .startup-knapper {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
      max-width: 300px;
    }

    .startup-knapp {
      padding: 16px;
      border: 1px solid #222;
      background: none;
      color: #fff;
      font-size: 0.9rem;
      letter-spacing: 0.1em;
      cursor: pointer;
      border-radius: 4px;
      transition: background 0.2s;
    }

    .startup-knapp:active { background: #111; }
    .startup-knapp.primaer { border-color: #fff; }

    /* ‚îÄ‚îÄ DATO-LISTE ‚îÄ‚îÄ */
    .dato-rad {
      padding: 16px 0;
      border-bottom: 1px solid #111;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }

    .dato-rad:active { background: #0a0a0a; }

    .dato-tekst { font-size: 0.95rem; color: #ccc; }
    .dato-antall { font-size: 0.8rem; color: #444; }

    /* ‚îÄ‚îÄ HANDLINGER ‚îÄ‚îÄ */
    .handlinger {
      display: flex;
      gap: 8px;
      padding: 8px 16px;
      border-top: 1px solid #1a1a1a;
      flex-shrink: 0;
    }

    .handling-knapp {
      flex: 1;
      padding: 10px;
      background: none;
      border: 1px solid #1a1a1a;
      color: #444;
      font-size: 0.75rem;
      letter-spacing: 0.08em;
      cursor: pointer;
      border-radius: 4px;
    }

    .handling-knapp:active { border-color: #555; color: #fff; }

    .checkmark { color: #4caf50; }
  </style>
</head>
<body>

<!-- ‚îÄ‚îÄ STARTUP ‚îÄ‚îÄ -->
<div class="startup-overlay" id="startupOverlay">
  <div class="startup-logo">///== | - LoggR - | ==\\\</div>
  <div class="startup-sub">Loggf√∏r √∏yeblikket. Enkelt.</div>
  <div class="startup-info" id="startupInfo"></div>
  <div class="startup-knapper" id="startupKnapper"></div>
</div>

<!-- ‚îÄ‚îÄ HOVED-APP ‚îÄ‚îÄ -->
<div class="header">
  <div class="header-tittel">///== | - LoggR - | ==\\\</div>
  <div class="header-logg" id="aktivLoggNavn"></div>
</div>

<div class="logg-visning" id="loggVisning"></div>

<div class="handlinger">
  <button class="handling-knapp" onclick="visArkiv()">üìÅ Arkiv</button>
  <button class="handling-knapp" id="kopierKnapp" onclick="kopierLogg()">üìã Kopier</button>
  <button class="handling-knapp" onclick="visAvslutt()">‚öôÔ∏è Avslutt logg</button>
</div>

<div class="input-omrade">
  <input
    class="input-felt"
    id="inputFelt"
    type="text"
    placeholder="Skriv her..."
    autocomplete="off"
    autocorrect="off"
    autocapitalize="off"
  />
  <button class="send-knapp" onclick="loggfor()">‚Üµ</button>
</div>

<!-- ‚îÄ‚îÄ ARKIV OVERLAY ‚îÄ‚îÄ -->
<div class="overlay" id="arkivOverlay">
  <div class="overlay-header">
    <div class="overlay-tittel">ARKIV</div>
    <button class="lukk-knapp" onclick="lukkArkiv()">‚úï</button>
  </div>
  <div class="overlay-innhold" id="arkivInnhold"></div>
</div>

<!-- ‚îÄ‚îÄ AVSLUTT OVERLAY ‚îÄ‚îÄ -->
<div class="overlay" id="avsluttOverlay">
  <div class="overlay-header">
    <div class="overlay-tittel">AVSLUTT LOGG</div>
    <button class="lukk-knapp" onclick="lukkAvslutt()">‚úï</button>
  </div>
  <div class="overlay-innhold">
    <div style="padding: 20px 0; color: #555; font-size: 0.9rem; line-height: 1.8; margin-bottom: 24px;">
      Husk √• kopiere loggen om du vil journalf√∏re n√• :)
    </div>
    <div style="display: flex; flex-direction: column; gap: 12px;">
      <button class="startup-knapp primaer" onclick="slettOgAvslutt()">Slett og avslutt logg</button>
      <button class="startup-knapp" onclick="beholdOgAvslutt()">Behold og avslutt logg</button>
      <button class="startup-knapp" id="avsluttKopierKnapp" onclick="kopierFraAvslutt()">Kopier til utklippstavle</button>
      <button class="startup-knapp" onclick="lukkAvslutt()" style="color:#333; border-color:#111;">Avbryt</button>
    </div>
  </div>
</div>

<script>
  // ============================================================
  //  DATALAGRING
  // ============================================================
  function hentAlle() {
    return JSON.parse(localStorage.getItem('loggr_data') || '{}');
  }

  function lagreAlle(data) {
    localStorage.setItem('loggr_data', JSON.stringify(data));
  }

  function dagensNokkel() {
    const n = new Date();
    const dd = String(n.getDate()).padStart(2, '0');
    const mm = String(n.getMonth() + 1).padStart(2, '0');
    const yy = String(n.getFullYear()).slice(-2);
    return `${dd}.${mm}.${yy}`;
  }

  function tidNaa() {
    const n = new Date();
    const hh = String(n.getHours()).padStart(2, '0');
    const mi = String(n.getMinutes()).padStart(2, '0');
    return `${hh}:${mi}`;
  }

  // ============================================================
  //  APP-TILSTAND
  // ============================================================
  let aktivDato = null;
  let aktivLoggIndeks = 0;

  function hentLoggNavn() {
    if (aktivLoggIndeks === 0) return `Logg - ${aktivDato}`;
    return `Logg ${aktivLoggIndeks + 1} - ${aktivDato}`;
  }

  function hentAktivLogg() {
    const data = hentAlle();
    const datoData = data[aktivDato] || [];
    return datoData[aktivLoggIndeks] || [];
  }

  function lagreAktivLogg(linjer) {
    const data = hentAlle();
    if (!data[aktivDato]) data[aktivDato] = [];
    data[aktivDato][aktivLoggIndeks] = linjer;
    lagreAlle(data);
  }

  // ============================================================
  //  STARTUP
  // ============================================================
  function visStartup() {
    const overlay = document.getElementById('startupOverlay');
    overlay.style.display = 'flex';

    const info = document.getElementById('startupInfo');
    const knapper = document.getElementById('startupKnapper');
    const data = hentAlle();
    const datoer = Object.keys(data).sort((a, b) => {
      return parseDato(b) - parseDato(a);
    });

    const nyeste = datoer[0];
    const harLogg = nyeste && data[nyeste] && data[nyeste].length > 0;

    if (harLogg) {
      const sisteLogg = data[nyeste][data[nyeste].length - 1];
      const antall = sisteLogg.length;
      info.innerHTML = `Det finnes en tidligere logg:<br><span style="color:#fff">${nyeste} ‚Äî ${antall} innlegg</span>`;
      knapper.innerHTML = `
        <button class="startup-knapp primaer" onclick="fortsettLogg('${nyeste}', ${data[nyeste].length - 1})">Fortsett forrige logg</button>
        <button class="startup-knapp" onclick="nyLogg()">Start ny loggf√∏ring</button>
      `;
    } else {
      info.innerHTML = `Ingen tidligere logger funnet.`;
      knapper.innerHTML = `
        <button class="startup-knapp primaer" onclick="nyLogg()">Start ny loggf√∏ring</button>
      `;
    }
  }

  function fortsettLogg(dato, indeks) {
    aktivDato = dato;
    aktivLoggIndeks = indeks;
    lukkStartup();
    oppdaterVisning();
  }

  function nyLogg() {
    aktivDato = dagensNokkel();
    const data = hentAlle();
    if (!data[aktivDato]) {
      aktivLoggIndeks = 0;
    } else {
      aktivLoggIndeks = data[aktivDato].length;
    }
    lagreAktivLogg([]);
    lukkStartup();
    oppdaterVisning();
  }

  function lukkStartup() {
    document.getElementById('startupOverlay').style.display = 'none';
  }

  // ============================================================
  //  LOGGF√òRING
  // ============================================================
  function loggfor() {
    const felt = document.getElementById('inputFelt');
    const tekst = felt.value.trim();
    if (!tekst) return;

    const tid = tidNaa();
    const formatert = tekst.charAt(0).toUpperCase() + tekst.slice(1);
    const linje = { tid, tekst: formatert };

    const linjer = hentAktivLogg();
    linjer.push(linje);
    lagreAktivLogg(linjer);

    felt.value = '';
    oppdaterVisning();

    // Scroll til bunnen
    const visning = document.getElementById('loggVisning');
    visning.scrollTop = visning.scrollHeight;
  }

  // Enter-tast
  document.getElementById('inputFelt').addEventListener('keydown', e => {
    if (e.key === 'Enter') loggfor();
  });

  // ============================================================
  //  VISNING
  // ============================================================
  function oppdaterVisning() {
    document.getElementById('aktivLoggNavn').textContent = hentLoggNavn();

    const visning = document.getElementById('loggVisning');
    const linjer = hentAktivLogg();

    if (linjer.length === 0) {
      visning.innerHTML = '<div class="tom-melding">Ingen loggf√∏ringer enn√•.<br>Skriv noe og trykk ‚Üµ</div>';
      return;
    }

    visning.innerHTML = linjer.map(l => `
      <div class="logg-linje">
        <span class="tid">${l.tid}</span>
        <span class="tekst">${l.tekst}</span>
      </div>
    `).join('');

    visning.scrollTop = visning.scrollHeight;
  }

  // ============================================================
  //  KOPIER
  // ============================================================
  function kopierLogg() {
    const linjer = hentAktivLogg();
    if (linjer.length === 0) return;
    const tekst = linjer.map(l => `${l.tid} - ${l.tekst}`).join('\n');
    navigator.clipboard.writeText(tekst).then(() => {
      const knapp = document.getElementById('kopierKnapp');
      knapp.textContent = '‚úÖ Kopiert!';
      setTimeout(() => { knapp.textContent = 'üìã Kopier'; }, 2000);
    });
  }

  function kopierFraAvslutt() {
    const linjer = hentAktivLogg();
    if (linjer.length === 0) return;
    const tekst = linjer.map(l => `${l.tid} - ${l.tekst}`).join('\n');
    navigator.clipboard.writeText(tekst).then(() => {
      const knapp = document.getElementById('avsluttKopierKnapp');
      knapp.textContent = '‚úÖ Kopiert! :)';
    });
  }

  // ============================================================
  //  ARKIV
  // ============================================================
  function visArkiv() {
    const overlay = document.getElementById('arkivOverlay');
    overlay.classList.add('aktiv');

    const innhold = document.getElementById('arkivInnhold');
    const data = hentAlle();
    const datoer = Object.keys(data).sort((a, b) => parseDato(b) - parseDato(a));

    if (datoer.length === 0) {
      innhold.innerHTML = '<div class="tom-melding">Ingen logger funnet.</div>';
      return;
    }

    innhold.innerHTML = datoer.map(dato => {
      const antall = data[dato].length;
      const loggTekst = antall === 1 ? 'logg' : 'logger';
      return `
        <div class="dato-rad" onclick="apneDato('${dato}')">
          <span class="dato-tekst">${dato}</span>
          <span class="dato-antall">${antall} ${loggTekst} ‚Üí</span>
        </div>
      `;
    }).join('');
  }

  function apneDato(dato) {
    const data = hentAlle();
    const logger = data[dato] || [];
    const innhold = document.getElementById('arkivInnhold');

    innhold.innerHTML = `
      <div class="dato-rad" onclick="visArkiv()" style="margin-bottom: 16px;">
        <span style="color:#555; font-size: 0.8rem;">‚Üê Tilbake</span>
      </div>
      <div style="color:#fff; margin-bottom: 16px; font-size: 0.9rem;">${dato}</div>
      ${logger.map((logg, i) => {
        const navn = i === 0 ? `Logg - ${dato}` : `Logg ${i + 1} - ${dato}`;
        const linjer = logg.map(l => `
          <div class="logg-linje">
            <span class="tid">${l.tid}</span>
            <span class="tekst">${l.tekst}</span>
          </div>
        `).join('');
        return `
          <div style="margin-bottom: 24px;">
            <div style="font-size: 0.75rem; color: #444; letter-spacing: 0.1em; margin-bottom: 8px;">${navn}</div>
            ${linjer || '<div style="color:#333; font-size:0.85rem;">Tom logg</div>'}
          </div>
        `;
      }).join('')}
    `;
  }

  function lukkArkiv() {
    document.getElementById('arkivOverlay').classList.remove('aktiv');
  }

  // ============================================================
  //  AVSLUTT
  // ============================================================
  function visAvslutt() {
    document.getElementById('avsluttOverlay').classList.add('aktiv');
    document.getElementById('avsluttKopierKnapp').textContent = 'Kopier til utklippstavle';
  }

  function lukkAvslutt() {
    document.getElementById('avsluttOverlay').classList.remove('aktiv');
  }

  function slettOgAvslutt() {
    const data = hentAlle();
    if (data[aktivDato]) {
      data[aktivDato].splice(aktivLoggIndeks, 1);
      if (data[aktivDato].length === 0) delete data[aktivDato];
      lagreAlle(data);
    }
    lukkAvslutt();
    visStartup();
  }

  function beholdOgAvslutt() {
    lukkAvslutt();
    visStartup();
  }

  // ============================================================
  //  HJELPEFUNKSJONER
  // ============================================================
  function parseDato(d) {
    const [dd, mm, yy] = d.split('.');
    return new Date(`20${yy}-${mm}-${dd}`).getTime();
  }

  // ============================================================
  //  SERVICE WORKER
  // ============================================================
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js');
  }

  // ============================================================
  //  START
  // ============================================================
  visStartup();
</script>
</body>
</html>